From 1138de5f8cd27f376186058a4eb791262e4592c4 Mon Sep 17 00:00:00 2001
From: Dennis Gilmore <dennis@ausil.us>
Date: Wed, 19 Mar 2014 18:09:42 -0500
Subject: [PATCH 13/13] cleanups to make panda and beaglebone work

---
 include/configs/am335x_evm.h      | 2 +-
 include/configs/ti_omap4_common.h | 5 ++++-
 2 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/include/configs/am335x_evm.h b/include/configs/am335x_evm.h
index a291a2f..1dd4486 100644
--- a/include/configs/am335x_evm.h
+++ b/include/configs/am335x_evm.h
@@ -140,7 +140,7 @@
 
 #define CONFIG_BOOTCOMMAND \
 	"run findfdt; " \
-	"for target in ${boot_targets}; do run bootcmd_${target}; done" \
+	"for target in ${boot_targets}; do run bootcmd_${target}; done " \
 	"run nandboot;"
 
 /* NS16550 Configuration */
diff --git a/include/configs/ti_omap4_common.h b/include/configs/ti_omap4_common.h
index eb3240a..f9baa50 100644
--- a/include/configs/ti_omap4_common.h
+++ b/include/configs/ti_omap4_common.h
@@ -86,6 +86,7 @@
 /*
  * Environment setup
  */
+#ifndef CONFIG_SPL_BUILD
 #define CONFIG_EXTRA_ENV_SETTINGS \
 	DEFAULT_LINUX_BOOT_ENV \
 	"console=ttyO2,115200n8\0" \
@@ -124,10 +125,12 @@
 		"if test $fdtfile = undefined; then " \
 			"echo WARNING: Could not determine device tree to use; fi; \0" \
 	"loadfdt=load mmc ${bootpart} ${fdt_addr_r} ${bootdir}/${fdtfile}\0" \
+	BOOTCMDS_COMMON
+#endif
 
 #define CONFIG_BOOTCOMMAND \
 	"run findfdt; " \
-	"for target in ${boot_targets}; do run bootcmd_${target}; done"
+	"for target in ${boot_targets}; do run bootcmd_${target}; done "
 /*
  * Defines for SPL
  * It is known that this will break HS devices. Since the current size of
-- 
1.9.0

